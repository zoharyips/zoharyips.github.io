---
layout: post
title: Java - String ç±»
categories: Java
keywords: Java
modify: 2019-09-08 10:08
---

Java æä¾›äº†é»˜è®¤çš„å­—ç¬¦ä¸²ç±» (String), æœ¬æ–‡ä¸»è¦è®°è¿°äº†å…¶åŸºæœ¬ç”¨æ³•å’Œéœ€è¦æ³¨æ„çš„ç»†èŠ‚, æœ¬æ–‡å¿½ç•¥å·²è¿‡æ—¶æˆ–æœ‰å…³ Unicode çš„æ–¹æ³•


**ç›®å½•**

* TOC
{:toc}

## â€œStringå¯¹è±¡â€ã€€ä¸ã€€â€œå­—ç¬¦ä¸²â€

1. String å¯¹è±¡å¹¶ä¸ç­‰äºå­—ç¬¦ä¸², ä¸€ä¸ª String å®ä¾‹åŒ–å¯¹è±¡é€šè¿‡å…¶ç§æœ‰æˆå‘˜ (`private final char value[]`) æ¥ä¿å­˜å­—ç¬¦ä¸²å†…å®¹, ç”±äºä½¿ç”¨ä¹ æƒ¯, æˆ‘ä»¬é€šå¸¸å°† String å¯¹è±¡ä¿å­˜çš„å­—ç¬¦ä¸²æ•°ç»„ç§°ä¸º **å­—ç¬¦ä¸²çš„å€¼**

    ```java
    // Source Code
    /** The value is used for character storage. */
    private final char value[];
    ```

2. ç”±äº String å¯¹è±¡ä½¿ç”¨ `private final char value[]` æ•°æ®æˆå‘˜æ¥ä¿å­˜å­—ç¬¦ä¸²å†…å®¹ï¼Œå­—ç¬¦ä¸²ä»¥å¸¸é‡å­˜å‚¨ï¼ŒString å¯¹è±¡ä¸è¯¥å­—ç¬¦ä¸²ç»‘å®šåœ¨ä¸€èµ·ï¼Œå› æ­¤ **String æ˜¯ä¸å¯å˜çš„**ï¼›æˆ‘ä»¬æ›´æ”¹å­—ç¬¦ä¸²çš„å†…å®¹æ—¶ï¼Œå®é™…ä¸Šæ˜¯é‡æ–°å¼€è¾Ÿäº†ä¸€ä¸ª String å®ä¾‹ç©ºé—´ï¼Œä½¿ç”¨åŸæ¥çš„å˜é‡åæŒ‡å‘è¯¥æ–°çš„å®ä¾‹ç©ºé—´ã€‚

    ```java
    // Test Code
    String string = "Hello World";
    String anotherName = string;
    string = "Hello man";
    System.out.println(anotherName == string);

    // Output:
    false
    ```

    anotherName æŒ‡å‘äº†åŸæ¥ string çš„åœ°å€ï¼Œfalse è¡¨ç¤º string æ‰€æŒ‡å‘çš„åœ°å€å‘ç”Ÿäº†æ”¹å˜ï¼Œå³è¯æ˜ï¼šString æ˜¯ä¸å¯å˜çš„

3. ç”±äºæˆ‘ä»¬æ‰€ç†è§£çš„å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯ String çš„ä¸€ä¸ªå¯¹è±¡, å› æ­¤å½“è¯¥å¯¹è±¡åæŒ‡å‘ä¸ºç©ºæ—¶, è°ƒç”¨å…¶ç›¸å…³æ–¹æ³•å°†å‘ç”Ÿç©ºæŒ‡é’ˆå¼‚å¸¸, å¦‚: 
    ```java
    // Test Code
    String str = null;
    System.out.printf(str.hashCode()); // Exception!
    ```

## String å¯¹è±¡çš„å”¯ä¸€æ€§åˆ¤æ–­

* ä½¿ç”¨ `==` åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„ **çœŸå®åœ°å€** æ˜¯å¦ç›¸ç­‰

* String é‡å†™ `equals()` æ–¹æ³•: é€ä¸ªå­—ç¬¦å¯¹æ¯”åˆ¤æ–­å­—ç¬¦ä¸²å¯¹è±¡çš„ **å†…å®¹** æ˜¯å¦ç›¸ç­‰

* String é‡å†™ `hashCode()` æ–¹æ³•: ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²ç®—å‡ºæ¥çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œé String å¯¹è±¡çš„åœ°å€ç©ºé—´

    ```java
    // Source Code
    public int hashCode() {
        int h = hash;
        if (h == 0 && value.length > 0) {
            char val[] = value;

            for (int i = 0; i < value.length; i++) {
                h = 31 * h + val[i];
            }
            hash = h;
        }
        return h;
    }
    ```

å› æ­¤ï¼Œä½¿ç”¨ `==` å¯åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡ï¼Œä½¿ç”¨ `equals()` å’Œ `hashCode()` æ¥åˆ¤æ–­å­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚

```java
// Test Code
String str1 = new String("Hello world");
String str2 = new String("Hello world");
System.out.println(str1 == str2);
System.out.println(str1.equals(str2));
System.out.println(str1.hashCode() == str2.hashCode());

// Output:
false
true
true
```


## è¿æ¥å­—ç¬¦ä¸²

* ä½¿ç”¨ `+` è¿æ¥äºŒå­—ç¬¦ä¸²

    ä½¿ç”¨æ­¤æ“ä½œç¬¦è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥ï¼Œæ— è®ºè¿æ¥çš„å³æ“ä½œæ•°æ˜¯å¦ä¸ºç©ºï¼Œéƒ½å°†è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼ˆå³ä½¿è¯¥æ–°å­—ç¬¦ä¸²ä¸åŸå­—ç¬¦ä¸²ä¸€æ ·ï¼‰

* ä½¿ç”¨ `concat()` æ–¹æ³•è¿æ¥äºŒå­—ç¬¦ä¸²

    ä½¿ç”¨ `concat()` æ–¹æ³•è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥æ—¶ï¼Œè‹¥ä¼ å…¥çš„æ˜¯ nullï¼Œåˆ™å°†æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå› ä¸ºå†…éƒ¨è°ƒç”¨äº†è¯¥å‚æ•°çš„ length æ–¹æ³•ï¼›åŒæ—¶ï¼Œè‹¥ä¼ å…¥çš„æ˜¯ `""`ï¼Œåˆ™å°†è¿”å›åŸå¯¹è±¡ï¼Œè¿™ä¸€ç‚¹ä¸ `+` æˆªç„¶ä¸åŒï¼š

    ```java
    // Source Code
    public String concat(String str) {
        int otherLen = str.length();
        if (otherLen == 0) {
            return this;
        }
        int len = value.length;
        char buf[] = Arrays.copyOf(value, len + otherLen);
        str.getChars(buf, len);
        return new String(buf, true);
    }
    ```

å¦‚ [â€œStringå¯¹è±¡â€ã€€ä¸ã€€â€œå­—ç¬¦ä¸²â€](#â€œStringå¯¹è±¡â€ã€€ä¸ã€€â€œå­—ç¬¦ä¸²â€) æ‰€è¯´ï¼Œå­—ç¬¦ä¸²ä¸ºå¸¸é‡ï¼Œæ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ï¼Œè‹¥å­—ç¬¦ä¸²å‘ç”Ÿæ›´æ”¹ï¼Œå¿…å°†è¿”å›ä¸€ä¸ªåŒ…å«æ–°å€¼çš„æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼

```java
// Test Code
String string = "Hello World";
String anotherName = string;
string.concat("");
System.out.println(anotherName == string);
string = string + "";
System.out.println(anotherName == string);

//Output:
true
false
```

## å­—ç¬¦ä¸²çš„é•¿åº¦


### å­—ç¬¦ä¸²çš„ç¼–ç 

```java
// Source Code
/**
 * ...The Java
 * platform uses the UTF-16 representation in {@code char} arrays and
 * in the {@code String} and {@code StringBuffer} classes...
 */
```

Java ä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯ Unicodeï¼Œæ–‡æ¡£ä¸­å£°åé»˜è®¤ä½¿ç”¨ UTF-16 ç¼–ç æ–¹å¼è§£æ Unicodeï¼Œä½†ç”±äº UTF-16 å­—ç¬¦å›ºå®šå  2 å­—èŠ‚é•¿åº¦ï¼Œå¯¹äºè‹±æ–‡å­—ç¬¦ï¼ˆASCII å­—ç¬¦å  1 å­—èŠ‚ï¼‰è€Œè¨€è¿‡äºå ç”¨ç©ºé—´ï¼Œå› æ­¤ Java ä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„ç¼–ç æ–¹å¼å¯¹ Unicode è¿›è¡Œè§£æï¼Œä½¿ç”¨éè‹±æ–‡çš„ç³»ç»Ÿå¤§å¤šä½¿ç”¨ UTF-8 ç¼–ç ï¼š

```java
// Test Code
System.out.println(Charset.defaultCharset());

// Output:
UTF-8
```

* Unicode é€šç§°ä¸‡å›½ç ï¼Œé€šè¿‡æ•°å­—ç¼–ç çš„æ–¹å¼æ¥å­˜å‚¨å­—ç¬¦ï¼Œç†è®ºé•¿åº¦ä» 000000 åˆ° 10FFFF å…± 4180000 ï¼ˆ2^20 + 2^16ï¼‰ä¸ªç¼–ç ï¼› 

* UTFï¼ˆUnicode Transformation Formatï¼‰æ˜¯ Unicode ä»æ•°å­—è½¬åŒ–ä¸ºå­—ç¬¦çš„æ–¹æ¡ˆï¼Œè€Œ UTF-8 æ˜¯å…¶ä¸­ä¸€å¥—å¯å˜é•¿åº¦çš„è½¬åŒ–æ–¹æ¡ˆï¼ŒUTF-16 æ˜¯åŒå­—èŠ‚å®šé•¿çš„è½¬åŒ–æ–¹æ¡ˆï¼›è¿™å°±è¡¨æ˜äº†ï¼Œå¯¹äºè‹±æ–‡å­—ç¬¦ï¼ŒUTF-8 å°†ä»…å ç”¨å•å­—èŠ‚é•¿åº¦æ¥è¡¨ç¤ºï¼Œå¤§å¤§èŠ‚çœäº†ç©ºé—´ã€‚

* UTF-8 è½¬æ¢è§„åˆ™

    * å¦‚æœåªæœ‰ä¸€ä¸ªå­—èŠ‚åˆ™å…¶æœ€é«˜äºŒè¿›åˆ¶ä½ä¸º0ï¼›

    * å¦‚æœæ˜¯å¤šå­—èŠ‚ï¼Œå…¶ç¬¬ä¸€ä¸ªå­—èŠ‚ä»æœ€é«˜ä½å¼€å§‹ï¼Œè¿ç»­çš„äºŒè¿›åˆ¶ä½å€¼ä¸º1çš„ä¸ªæ•°å†³å®šäº†å…¶ç¼–ç çš„å­—èŠ‚æ•°ï¼Œå…¶ä½™å„å­—èŠ‚å‡ä»¥10å¼€å¤´ã€‚

    * UTF-8 è½¬æ¢è¡¨

        Unicode | bit | Unit | UTF-8 | byte 
        :-: | :-: | :-: | :-: | :-:
        0000 ~ 007F | 00~07 | 1 | 0XXX XXXX | 1
        0080 ~ 07FF | 08~11 | 1 | 110X XXXX<br/>10XX XXXX | 2
        0800 ~ FFFF | 12~16 | 1 | 110X XXXX<br/>10XX XXXX<br/>10XX XXXX | 3
        01 0000 ~ 10 FFFF | 17~21 | 2~n | 110X XXXX<br/>10XX XXXX<br/>10XX XXXX<br/>10XX XXXX | 4

### å­—ç¬¦é•¿åº¦ä¸å­—ç¬¦ä¸²é•¿åº¦

å¦‚æœç³»ç»Ÿé‡‡ç”¨çš„ç¼–ç æ–¹å¼æ˜¯ UTF-8ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„å­—ç¬¦ä¸²çš„é•¿åº¦ä¼šå˜æ¥å˜å»ï¼›è¿™æ˜¯ç”±äº UTF-8 æ˜¯å¯å˜é•¿çš„ç¼–ç æ–¹å¼æ‰€å†³å®šçš„ï¼š

```java
// Test Code
String string;
string = "ab";
getStringInfo(string);
string = "ä½ å¥½";
getStringInfo(string);
string = "ğ¡ƒğ¡ƒ";
getStringInfo(string);
string = "ğŸ‘¦ğŸ‘©";
getStringInfo(string);
string = "ğŸ‘½ğŸ‘½â€";
getStringInfo(string);

...
private static void getStringInfo(String string) {
    System.out.println(string + ".length\t\t\t\t= " + string.length());
    System.out.println(string + ".toCharArray.length\t= " + string.toCharArray().length);
    System.out.println(string + ".getBytes.length\t= " + string.getBytes().length);
}

// Output:
ab.length = 2
ab.toCharArray.length = 2
ab.getBytes.length = 2
ä½ å¥½.length = 2
ä½ å¥½.toCharArray.length = 2
ä½ å¥½.getBytes.lengt = 6
ğ¡ƒğ¡ƒ.length = 4
ğ¡ƒğ¡ƒ.toCharArray.length = 4
ğ¡ƒğ¡ƒ.getBytes.length = 8
ğŸ‘¦ğŸ‘©.length = 4
ğŸ‘¦ğŸ‘©.toCharArray.length = 4
ğŸ‘¦ğŸ‘©.getBytes.length = 8
ğŸ‘½ğŸ‘½.length = 5
ğŸ‘½ğŸ‘½.toCharArray.length = 5
ğŸ‘½ğŸ‘½.getBytes.length = 11
```

* `String.length()` æ–¹æ³•è¿”å›çš„æ˜¯ Unicode å•å…ƒçš„é•¿åº¦

* `String.toCharArray.length()` String æœ¬æ¥å°±æ˜¯ Char æ•°ç»„ï¼ŒåŒæ ·æ˜¯ Unicode å•å…ƒçš„é•¿åº¦

* `String.getBytes.length()` æ–¹æ³•å°†è¿”å› UTF-8 ç¼–ç çš„å­—èŠ‚æ•°ç»„é•¿åº¦

ç›®å‰çš„ Unicode å­—ç¬¦åˆ†ä¸º17ç»„ç¼–æ’ï¼Œ0x0000 è‡³ 0x10FFFFï¼Œæ¯ç»„ç§°ä¸ºå¹³é¢ï¼ˆPlaneï¼‰ï¼Œè€Œæ¯å¹³é¢æ‹¥æœ‰FFFF(65536) ä¸ªç ä½ã€‚æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„å­—ç¬¦åŸºæœ¬ä¸Šéƒ½åœ¨ BMP(Basic Multilingual Planeï¼ŒåŸºæœ¬å¤šè¯­è¨€å¹³é¢) ä¸­ï¼Œå³ Plane 0ï¼ŒèŒƒå›´ä¸ºï¼š0000 ~ FFFF å…± 65536 ä¸ªå­—ç¬¦ï¼Œå  1 ä¸ª Unicode å•å…ƒï¼Œä»è½¬æ¢è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…¶ UTF-8 ç¼–ç å  1~3 ä¸ª bit é•¿åº¦ã€‚

å› æ­¤ï¼Œä¸Šä¾‹å­ä¸­çš„ `ğ¡ƒğ¡ƒ`ã€`ğŸ‘¦ğŸ‘©`ã€`ğŸ‘½ğŸ‘½â€` ç”±äºæ˜¯ Unicode 3.0 ååŠ å…¥çš„å­—ç¬¦ï¼Œæ—©å·²è¶…å‡º BMP æ‰€èƒ½è¡¨ç¤ºçš„å­—ç¬¦ï¼Œå› æ­¤éœ€è¦å ç”¨ 2 ä¸ªåŠä»¥ä¸Šçš„ Unicode å•å…ƒï¼Œå› æ­¤æ‰€æ±‚å¾—çš„å­—ç¬¦ä¸²é•¿åº¦ä¼šå’Œæ˜¾ç¤ºçš„å­—ç¬¦é•¿åº¦ä¸ä¸€è‡´ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘ï¼

è€Œç”±äº UTF-8 æ˜¯å˜é•¿ç¼–ç ï¼ŒByte æ•°ç»„é•¿åº¦ä¸ä¸€åˆ™æ˜¯å¾ˆæ­£å¸¸çš„è¡¨ç°äº†ã€‚

è€Œå¦‚æœéœ€è¦è·å–ä¸å®é™…ç›¸æ¯”è¾ƒç²¾å‡†çš„å­—ç¬¦æ•°é‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨ `String.codePotinCount` æ–¹æ³•ï¼š

```java
// Test Code
string = "ab";
System.out.println(string.codePointCount(0, string.length()));
string = "ä½ å¥½";
System.out.println(string.codePointCount(0, string.length()));
string = "ğ¡ƒğ¡ƒ";
System.out.println(string.codePointCount(0, string.length()));
string = "ğŸ‘¦ğŸ‘©";
System.out.println(string.codePointCount(0, string.length()));
string = "ğŸ‘½ğŸ‘½â€";
System.out.println(string.codePointCount(0, string.length()));

// Output:
2
2
2
2
3
```

è‡³äº... æœ€åä¸€ä¸ªæ˜¯æ€ä¹ˆå›äº‹ï¼Œæˆ‘è‡³ä»Šæ²¡ææ‡‚...